<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up - CodeBear</title>
  <meta name="description" content="Start your coding adventure with CodeBear">
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: 'hsl(25, 100%, 50%)',
            'primary-foreground': 'hsl(0, 0%, 100%)',
            background: 'hsl(0, 0%, 100%)',
            foreground: 'hsl(222.2, 84%, 4.9%)',
            card: 'hsl(0, 0%, 100%)',
            'card-foreground': 'hsl(222.2, 84%, 4.9%)',
            border: 'hsl(214.3, 31.8%, 91.4%)',
            muted: 'hsl(210, 40%, 96.1%)',
            'muted-foreground': 'hsl(215.4, 16.3%, 46.9%)',
            destructive: 'hsl(0, 84.2%, 60.2%)',
          },
          animation: {
            'bounce-gentle': 'bounce 3s ease-in-out infinite',
          }
        }
      }
    }
  </script>
  
  <style>
    @keyframes bounce-gentle {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    
    .card-elevated {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, hsl(25, 100%, 50%) 0%, hsl(40, 100%, 50%) 100%);
      transition: all 0.2s;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px -5px rgba(255, 127, 0, 0.4);
    }
    
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .spinner {
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 0.6s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
  
  <!-- Supabase JS Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="min-h-screen bg-background">
  <!-- Header -->
  <header class="p-4">
    <a href="index.html" class="flex items-center gap-2 w-fit">
      <div class="flex items-center justify-center w-10 h-10 rounded-xl bg-primary">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-primary-foreground" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="16 18 22 12 16 6"></polyline>
          <polyline points="8 6 2 12 8 18"></polyline>
        </svg>
      </div>
      <span class="text-xl font-extrabold text-foreground">CodeBear</span>
    </a>
  </header>

  <main class="flex-1 flex items-center justify-center p-4 mt-8">
    <div class="w-full max-w-md">
      <!-- Mascot -->
      <div class="flex justify-center mb-6">
        <img src="mascot.png" alt="CodeBear" class="w-24 h-24 animate-bounce-gentle">
      </div>

      <div class="bg-card rounded-2xl border border-border p-8 card-elevated">
        <h1 class="text-2xl font-extrabold text-center text-foreground mb-2">
          Create your account
        </h1>
        <p class="text-center text-muted-foreground mb-6">
          Start your coding adventure today!
        </p>

        <form id="signupForm" class="space-y-4">
          <!-- Email -->
          <div class="space-y-2">
            <label for="email" class="block text-sm font-medium text-foreground">Email</label>
            <div class="relative">
              <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect width="20" height="16" x="2" y="4" rx="2"></rect>
                <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
              </svg>
              <input
                id="email"
                type="email"
                placeholder="you@example.com"
                class="w-full pl-10 h-12 px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                required
              />
            </div>
          </div>

          <!-- Password -->
          <div class="space-y-2">
            <label for="password" class="block text-sm font-medium text-foreground">Password</label>
            <div class="relative">
              <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect width="18" height="11" x="3" y="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              <input
                id="password"
                type="password"
                placeholder="••••••••"
                class="w-full pl-10 h-12 px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                required
              />
            </div>
          </div>

          <!-- Confirm Password -->
          <div class="space-y-2">
            <label for="confirmPassword" class="block text-sm font-medium text-foreground">Confirm Password</label>
            <div class="relative">
              <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect width="18" height="11" x="3" y="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              <input
                id="confirmPassword"
                type="password"
                placeholder="••••••••"
                class="w-full pl-10 h-12 px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                required
              />
            </div>
          </div>

          <!-- Error Message -->
          <div id="errorMessage" class="hidden text-sm text-destructive text-center bg-red-50 p-3 rounded-lg"></div>

          <!-- Signup Button -->
          <button
            type="submit"
            id="signupButton"
            class="w-full h-12 px-4 text-white font-semibold rounded-lg btn-primary flex items-center justify-center gap-2"
          >
            <span id="signupButtonText">Create Account</span>
            <svg id="signupButtonIcon" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M5 12h14"></path>
              <path d="m12 5 7 7-7 7"></path>
            </svg>
            <div id="signupSpinner" class="hidden spinner"></div>
          </button>
        </form>

        <!-- Divider -->
        <div class="relative my-6">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-border"></div>
          </div>
          <div class="relative flex justify-center text-xs uppercase">
            <span class="bg-card px-2 text-muted-foreground">Or continue with</span>
          </div>
        </div>

        <!-- Google Sign In Button (Hidden by default due to OAuth setup) -->
        <button
          type="button"
          id="googleSignInButton"
          class="hidden w-full h-12 px-4 border border-border font-semibold rounded-lg flex items-center justify-center gap-2 hover:bg-muted transition-colors"
        >
          <svg class="w-5 h-5" viewBox="0 0 24 24">
            <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
            <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
            <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
            <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
          </svg>
          <span id="googleButtonText">Continue with Google</span>
          <div id="googleSpinner" class="hidden spinner"></div>
        </button>

        <!-- Links -->
        <div class="mt-6 space-y-2 text-center">
          <p class="text-muted-foreground">
            Already have an account? 
            <a href="login.html" class="text-primary font-semibold hover:underline">Log in</a>
          </p>
          <p class="text-muted-foreground text-sm">
            Admin? 
            <a href="admin-login.html" class="text-primary font-semibold hover:underline">Admin Login</a>
          </p>
        </div>
      </div>
    </div>
  </main>

  <!-- Load Config & Auth Manager -->
  <script src="config.js"></script>
  <script src="auth.js"></script>
  
  <!-- Signup Page Script -->
  <script>
    const signupForm = document.getElementById('signupForm');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const signupButton = document.getElementById('signupButton');
    const signupButtonText = document.getElementById('signupButtonText');
    const signupButtonIcon = document.getElementById('signupButtonIcon');
    const signupSpinner = document.getElementById('signupSpinner');
    const errorMessage = document.getElementById('errorMessage');
    const googleSignInButton = document.getElementById('googleSignInButton');
    const googleButtonText = document.getElementById('googleButtonText');
    const googleSpinner = document.getElementById('googleSpinner');

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.classList.remove('hidden');
    }

    function hideError() {
      errorMessage.classList.add('hidden');
    }

    function setLoading(isLoading) {
      signupButton.disabled = isLoading;
      googleSignInButton.disabled = isLoading;
      
      if (isLoading) {
        signupButtonText.classList.add('hidden');
        signupButtonIcon.classList.add('hidden');
        signupSpinner.classList.remove('hidden');
      } else {
        signupButtonText.classList.remove('hidden');
        signupButtonIcon.classList.remove('hidden');
        signupSpinner.classList.add('hidden');
      }
    }

    function setGoogleLoading(isLoading) {
      googleSignInButton.disabled = isLoading;
      signupButton.disabled = isLoading;
      
      if (isLoading) {
        googleButtonText.classList.add('hidden');
        googleSpinner.classList.remove('hidden');
      } else {
        googleButtonText.classList.remove('hidden');
        googleSpinner.classList.add('hidden');
      }
    }

    // Handle form submission
    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      hideError();

      const email = emailInput.value;
      const password = passwordInput.value;
      const confirmPassword = confirmPasswordInput.value;

      // Validate passwords match
      if (password !== confirmPassword) {
        showError("Passwords don't match");
        return;
      }

      // Validate password length
      if (password.length < 6) {
        showError("Password must be at least 6 characters");
        return;
      }

      setLoading(true);

      const { error } = await window.authManager.signUp(email, password);

      if (error) {
        showError(error.message);
        setLoading(false);
      } else {
        // Redirect to learn page
        window.location.href = 'learn.html';
      }
    });

    // Handle Google Sign In (disabled by default due to OAuth setup requirement)
    googleSignInButton.addEventListener('click', async () => {
      hideError();
      setGoogleLoading(true);
      
      const { error } = await window.authManager.signInWithGoogle();
      
      if (error) {
        showError(error.message);
        setGoogleLoading(false);
      }
      // Note: On success, Supabase will redirect to the OAuth provider
    });

    // Check if user is already logged in
    window.authManager.subscribe((state) => {
      if (state.user && !state.loading) {
        window.location.href = 'learn.html';
      }
    });
  </script>
</body>
</html>
